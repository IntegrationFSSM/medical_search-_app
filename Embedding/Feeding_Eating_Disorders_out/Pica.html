<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Évaluation Pica – DSM-5-TR</title>
  <style>
  .top-bar {
    display: flex;
    align-items: center;
    background-color: #dff0dc;
    padding: 10px 20px;
    margin-bottom: 30px;
    border-radius: 6px;
  }
  .titre-centre {
    flex: 1;
    text-align: center;
  }
  .titre-centre h1 {
    margin: 0;
    font-size: 28px;
    color: #3d7a3b;
  }
  .titre-centre h2 {
    margin: 0;
    font-size: 20px;
    color: #3d7a3b;
  }
  .section-title {
    font-size: 24px;
    font-weight: bold;
    color: #3d7a3b;
    margin: 30px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 3px solid #8cc63f;
  }

    body { font-family: 'Segoe UI', sans-serif; max-width: 960px; margin: auto; padding: 20px; background: #f5fff8; color: #2e3b2c; }
    fieldset { border: 2px solid #8cc63f; padding: 15px; margin-bottom: 20px; background: #ffffff; }
    legend { font-weight: bold; color: #3d7a3b; }
    label { display: block; margin-bottom: 5px; }
    .subtitle {
      font-size: 0.9em;
      color: #666;
      font-style: italic;
    }
    .hidden {
      display: none;
    }
    .boutons-validation {
      display: flex;
      gap: 15px;
      margin: 40px 0 20px 0;
      justify-content: center;
    }
    .btn-valide {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      flex: 1;
      max-width: 300px;
    }
    .btn-valide:hover {
      background-color: #218838;
    }
    .btn-non-valide {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      flex: 1;
      max-width: 300px;
    }
    .btn-non-valide:hover {
      background-color: #c82333;
    }
  </style>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="top-bar">
  <div class="titre-centre">
    <h1>CLINIQUE LA VALLÉE</h1>
    <h2>Évaluation du Pica – DSM-5-TR</h2>
  </div>
</div>

<h2 class="section-title">Les critères diagnostiques</h2>

<form id="formulaire">

<!-- Critère A -->
<fieldset id="critereA">
  <legend>Critère A – Ingestion persistante de substances non nutritives et non alimentaires</legend>
  <p class="subtitle">Pendant une période d'au moins 1 mois</p>
  <label><input type="checkbox" name="critereA" value="Ingestion persistante de substances non nutritives"/> Ingestion persistante de substances non nutritives</label>
  <label><input type="checkbox" name="critereA" value="Ingestion persistante de substances non alimentaires"/> Ingestion persistante de substances non alimentaires</label>
  <label><input type="checkbox" name="critereA" value="Pendant au moins 1 mois"/> Pendant une période d'au moins 1 mois</label>
</fieldset>

<!-- Critère B -->
<fieldset id="critereB">
  <legend>Critère B – Inapproprié au niveau de développement</legend>
  <p class="subtitle">L'ingestion de substances non nutritives et non alimentaires est inappropriée au niveau de développement de l'individu</p>
  <label><input type="checkbox" id="choixB" value="Inapproprié au niveau de développement"/> Inapproprié au niveau de développement de l'individu</label>
</fieldset>

<!-- Critère C -->
<fieldset id="critereC">
  <legend>Critère C – Exclusion des pratiques culturelles/sociales</legend>
  <p class="subtitle">Le comportement alimentaire ne fait pas partie d'une pratique culturellement soutenue ou socialement normative</p>
  <label><input type="checkbox" name="critereC" value="Ne fait pas partie d'une pratique culturellement soutenue"/> Ne fait pas partie d'une pratique culturellement soutenue</label>
  <label><input type="checkbox" name="critereC" value="Ne fait pas partie d'une pratique socialement normative"/> Ne fait pas partie d'une pratique socialement normative</label>
</fieldset>

<!-- Critère D -->
<fieldset id="critereD">
  <legend>Critère D – Sévérité suffisante si dans contexte d'autre trouble</legend>
  <p class="subtitle">Si le comportement alimentaire survient dans le contexte d'un autre trouble mental ou d'une affection médicale, il est suffisamment sévère pour justifier une attention clinique additionnelle</p>
  <p style="font-size: 0.9em; color: #666; font-style: italic; margin: 10px 0;"><strong>Note :</strong> Si le pica survient dans le contexte d'un autre trouble mental (déficience intellectuelle, trouble du spectre de l'autisme, schizophrénie) ou d'une affection médicale (incluant la grossesse), la sévérité doit être suffisante pour justifier une attention clinique additionnelle.</p>
  <label><input type="checkbox" name="critereD" value="Si contexte d'autre trouble mental : sévérité suffisante pour attention additionnelle"/> Si dans le contexte d'un autre trouble mental : sévérité suffisante pour justifier attention clinique additionnelle</label>
  <label><input type="checkbox" name="critereD" value="Si contexte d'affection médicale (grossesse) : sévérité suffisante pour attention additionnelle"/> Si dans le contexte d'une affection médicale (incluant grossesse) : sévérité suffisante pour justifier attention clinique additionnelle</label>
  <label><input type="checkbox" name="critereD" value="Pas dans le contexte d'un autre trouble ou affection"/> Pas dans le contexte d'un autre trouble mental ou affection médicale</label>
</fieldset>

<!-- Âge -->
<fieldset id="age">
  <legend>Âge de l'individu (pour codage)</legend>
  <p class="subtitle">Le code ICD-10-CM dépend de l'âge</p>
  <p style="font-size: 0.9em; color: #666; font-style: italic; margin: 10px 0;"><strong>Note de codage :</strong> Les codes ICD-10-CM pour le pica sont F98.3 chez les enfants et F50.89 chez les adultes.</p>
  <label><input type="radio" name="age" value="F98.3 - Enfant"/> <strong>F98.3</strong> - Enfant</label>
  <label><input type="radio" name="age" value="F50.89 - Adulte"/> <strong>F50.89</strong> - Adulte</label>
</fieldset>

<!-- Rémission -->
<fieldset id="remission">
  <legend>Rémission (optionnel)</legend>
  <p class="subtitle">Préciser si applicable</p>
  <label><input type="radio" name="remission" value="En rémission"/> En rémission : Après que les critères complets aient été remplis, les critères n'ont pas été remplis pendant une période prolongée</label>
  <label><input type="radio" name="remission" value="Non applicable"/> Non applicable (trouble actif)</label>
</fieldset>

</form>

<h2 class="section-title" id="titre-diagnostic" style="display: none;">Diagnostic différentiel</h2>

<form id="formulaire-diff" style="display: none;">

<!-- Diagnostic différentiel -->
<fieldset id="diagnostic-differentiel">
  <legend>Diagnostic différentiel</legend>
  <p class="subtitle">Cocher les troubles à différencier</p>
  
  <label><input type="checkbox" name="diff_other" value="Autres troubles mentaux - Trouble du spectre de l'autisme, schizophrénie, syndrome de Kleine-Levin"/> Autres troubles mentaux - Trouble du spectre de l'autisme, schizophrénie, syndrome de Kleine-Levin</label>
  
  <label><input type="checkbox" name="diff_anorexia" value="Anorexie mentale - Consommation de substances non nutritives/non alimentaires pour contrôler l'appétit"/> Anorexie mentale - Consommation de substances non nutritives/non alimentaires pour contrôler l'appétit</label>
  
  <label><input type="checkbox" name="diff_factitious" value="Trouble factice - Ingestion intentionnelle d'objets étrangers dans contexte de falsification de symptômes physiques"/> Trouble factice - Ingestion intentionnelle d'objets étrangers dans contexte de falsification de symptômes physiques</label>
  
  <label><input type="checkbox" name="diff_selfinjury" value="Automutilation non suicidaire et troubles de la personnalité - Ingestion d'objets potentiellement nocifs"/> Automutilation non suicidaire et troubles de la personnalité - Ingestion d'objets potentiellement nocifs</label>
  
</fieldset>

</form>

<h2 class="section-title" id="titre-comorbidite" style="display: none;">Comorbidité</h2>

<form id="formulaire-comorb" style="display: none;">

<!-- Comorbidité -->
<fieldset id="comorbidite">
  <legend>Comorbidité</legend>
  <p class="subtitle">Troubles associés</p>
  
  <label><input type="checkbox" name="comorb_autism" value="Trouble du spectre de l'autisme - Comorbidité la plus fréquente"/> Trouble du spectre de l'autisme - Comorbidité la plus fréquente</label>
  
  <label><input type="checkbox" name="comorb_intellectual" value="Trouble du développement intellectuel (déficience intellectuelle) - Comorbidité la plus fréquente"/> Trouble du développement intellectuel (déficience intellectuelle) - Comorbidité la plus fréquente</label>
  
  <label><input type="checkbox" name="comorb_schizophrenia" value="Schizophrénie - Comorbidité moins fréquente"/> Schizophrénie - Comorbidité moins fréquente</label>
  
  <label><input type="checkbox" name="comorb_ocd" value="Trouble obsessionnel-compulsif - Comorbidité moins fréquente"/> Trouble obsessionnel-compulsif - Comorbidité moins fréquente</label>
  
  <label><input type="checkbox" name="comorb_trichotillomania" value="Trichotillomanie et trouble d'excoriation - Cheveux ou peau typiquement ingérés"/> Trichotillomanie et trouble d'excoriation - Cheveux ou peau typiquement ingérés</label>
  
  <label><input type="checkbox" name="comorb_arfid" value="Trouble de restriction/évitement de l'apport alimentaire - Particulièrement avec composante sensorielle forte"/> Trouble de restriction/évitement de l'apport alimentaire - Particulièrement avec composante sensorielle forte</label>
  
  <label><input type="checkbox" name="comorb_medical" value="Complications médicales - Gastro-intestinales, empoisonnement, infection, déficience nutritionnelle"/> Complications médicales - Gastro-intestinales, empoisonnement, infection, déficience nutritionnelle</label>
  
</fieldset>

</form>

<div class="boutons-validation">
  <button type="button" class="btn-valide" onclick="validerFormulaireLocal(event)">✔️ VALIDER</button>
  <button type="button" class="btn-non-valide" onclick="nonValiderFormulaireLocal(event)">✘ NON VALIDER</button>
</div>

<script>
// Fonctions locales pour gérer l'affichage progressif (indépendantes des fonctions globales Django)
(function() {
  'use strict';
  let etapeNonValide = 0; // 0: début, 1: diagnostic affiché, 2: comorbidité affichée

  // Fonction locale pour valider (ne pas redéfinir la fonction globale)
  window.validerFormulaireLocal = function(event) {
    // Empêcher le comportement par défaut et la propagation
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    // Réinitialiser l'état local
    etapeNonValide = 0;
    
    // Cacher toutes les sections
    const titreDiag = document.getElementById("titre-diagnostic");
    const formDiag = document.getElementById("formulaire-diff");
    const titreComorb = document.getElementById("titre-comorbidite");
    const formComorb = document.getElementById("formulaire-comorb");
    
    if (titreDiag) titreDiag.style.display = "none";
    if (formDiag) formDiag.style.display = "none";
    if (titreComorb) titreComorb.style.display = "none";
    if (formComorb) formComorb.style.display = "none";
    
    // Appeler la fonction globale Django si elle existe
    if (typeof window.validerFormulaire === 'function') {
      window.validerFormulaire();
    }
    
    return false;
  };

  // Fonction locale pour non valider (ne pas redéfinir la fonction globale)
  window.nonValiderFormulaireLocal = function(event) {
    // Empêcher le comportement par défaut et la propagation IMMÉDIATEMENT
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    const titreDiag = document.getElementById("titre-diagnostic");
    const formDiag = document.getElementById("formulaire-diff");
    const titreComorb = document.getElementById("titre-comorbidite");
    const formComorb = document.getElementById("formulaire-comorb");
    
    if (etapeNonValide === 0) {
      // Premier clic : Afficher seulement Diagnostic différentiel (PAS d'enregistrement, PAS d'alerte)
      if (titreDiag) {
        titreDiag.style.display = "block";
        titreDiag.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (formDiag) formDiag.style.display = "block";
      etapeNonValide = 1;
      return false;
      
    } else if (etapeNonValide === 1) {
      // Deuxième clic : Afficher aussi Comorbidité (PAS d'enregistrement, PAS d'alerte)
      if (titreComorb) {
        titreComorb.style.display = "block";
        titreComorb.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (formComorb) formComorb.style.display = "block";
      etapeNonValide = 2;
      return false;
      
    } else if (etapeNonValide === 2) {
      // Troisième clic : Réinitialiser et appeler la fonction globale Django
      etapeNonValide = 0;
      
      // Réinitialiser l'affichage
      if (titreDiag) titreDiag.style.display = "none";
      if (formDiag) formDiag.style.display = "none";
      if (titreComorb) titreComorb.style.display = "none";
      if (formComorb) formComorb.style.display = "none";
      
      // Appeler la fonction globale Django pour enregistrer
      if (typeof window.nonValiderFormulaire === 'function') {
        window.nonValiderFormulaire();
      }
      
      return false;
    }
    
    return false;
  };
})();
</script>

<script>
(function() {
  if (typeof globalThis.validerFormulaire !== 'function') {
    globalThis.validerFormulaire = function() {
      Swal.fire({icon: 'success', title: 'Validé !', text: 'Formulaire marqué comme VALIDE', timer: 2000, showConfirmButton: false});
    };
  }
  if (typeof globalThis.nonValiderFormulaire !== 'function') {
    globalThis.nonValiderFormulaire = function() {
      Swal.fire({icon: 'warning', title: 'Non validé', text: 'Formulaire marqué comme NON VALIDE', timer: 2000, showConfirmButton: false});
    };
  }
})();
</script>

<div id="resultat"></div>

<footer style="text-align:center; font-size:0.9em; margin-top: 40px; padding-top: 15px; border-top: 1px solid #ccc;">
  <p>CLINIQUE LA VALLÉE – RIAD AL ANDALOUSSE VILLA 39, AV. ABDERRAHIM BOUABID, HAY RIAD 1, Rabat</p>
  <p>Date : 15/10/2025 — <strong style="color:darkred;">DOCUMENT CONFIDENTIEL</strong></p>
</footer>
</body>
</html>
