<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Évaluation Encoprésie – DSM-5-TR</title>
  <style>
  .top-bar {
    display: flex;
    align-items: center;
    background-color: #dff0dc;
    padding: 10px 20px;
    margin-bottom: 30px;
    border-radius: 6px;
  }
  .titre-centre {
    flex: 1;
    text-align: center;
  }
  .titre-centre h1 {
    margin: 0;
    font-size: 28px;
    color: #3d7a3b;
  }
  .titre-centre h2 {
    margin: 0;
    font-size: 20px;
    color: #3d7a3b;
  }
  .section-title {
    font-size: 24px;
    font-weight: bold;
    color: #3d7a3b;
    margin: 30px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 3px solid #8cc63f;
  }

    body { font-family: 'Segoe UI', sans-serif; max-width: 960px; margin: auto; padding: 20px; background: #f5fff8; color: #2e3b2c; }
    fieldset { border: 2px solid #8cc63f; padding: 15px; margin-bottom: 20px; background: #ffffff; }
    legend { font-weight: bold; color: #3d7a3b; }
    label { display: block; margin-bottom: 5px; }
        .subtitle {
      font-size: 0.9em;
      color: #666;
      font-style: italic;
    }
    .hidden {
      display: none;
    }
    .boutons-validation {
      display: flex;
      gap: 15px;
      margin: 40px 0 20px 0;
      justify-content: center;
    }
    .btn-valide {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      flex: 1;
      max-width: 300px;
    }
    .btn-valide:hover {
      background-color: #218838;
    }
    .btn-non-valide {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      flex: 1;
      max-width: 300px;
    }
    .btn-non-valide:hover {
      background-color: #c82333;
    }
  </style>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>
<body>

<div class="top-bar">
  <div class="titre-centre">
    <h1>CLINIQUE LA VALLÉE</h1>
    <h2>Évaluation de l'Encoprésie – DSM-5-TR</h2>
  </div>
</div>

<h2 class="section-title">Les critères diagnostiques</h2>

<form id="formulaire">

<!-- Critère A -->
<fieldset id="critereA">
  <legend>Critère A – Émission répétée de selles dans des endroits inappropriés</legend>
  <p class="subtitle">Que ce soit involontaire ou intentionnel (ex: vêtements, sol)</p>
  <label><input type="checkbox" name="critereA" value="Émission répétée de selles dans des endroits inappropriés"/> Émission répétée de selles dans des endroits inappropriés</label>
  <label><input type="checkbox" name="critereA" value="Dans les vêtements"/> Dans les vêtements</label>
  <label><input type="checkbox" name="critereA" value="Sur le sol"/> Sur le sol</label>
  <label><input type="checkbox" name="critereA" value="Involontaire"/> Involontaire</label>
  <label><input type="checkbox" name="critereA" value="Intentionnel"/> Intentionnel</label>
  
</fieldset>

<!-- Critère B -->
<fieldset id="critereB">
  <legend>Critère B – Fréquence (≥1 événement par mois pendant ≥3 mois)</legend>
  <p class="subtitle">Au moins un tel événement survient chaque mois pendant au moins 3 mois</p>
  <label><input type="checkbox" name="critereB" value="Au moins 1 événement par mois"/> Au moins 1 événement par mois</label>
  <label><input type="checkbox" name="critereB" value="Pendant au moins 3 mois"/> Pendant au moins 3 mois</label>
  
</fieldset>

<!-- Critère C -->
<fieldset id="critereC">
  <legend>Critère C – Âge chronologique</legend>
  <p class="subtitle">L'âge chronologique est d'au moins 4 ans (ou niveau de développement équivalent)</p>
  <label><input type="checkbox" id="choixC" value="Âge chronologique ≥4 ans"/> Âge chronologique ≥4 ans (ou niveau de développement équivalent)</label>
  
</fieldset>

<!-- Critère D -->
<fieldset id="critereD">
  <legend>Critère D – Exclusion des causes organiques</legend>
  <p class="subtitle">Le comportement n'est pas attribuable aux effets physiologiques d'une substance ou d'une affection médicale (sauf par un mécanisme impliquant la constipation)</p>
  <label><input type="checkbox" name="critereD" value="Pas attribuable à une substance (laxatifs)"/> Pas attribuable à une substance (ex: laxatifs)</label>
  <label><input type="checkbox" name="critereD" value="Pas attribuable à une affection médicale (sauf constipation)"/> Pas attribuable à une affection médicale (sauf par mécanisme impliquant la constipation)</label>
  
</fieldset>

<!-- Sous-type -->
<fieldset id="soustype">
  <legend>Sous-type</legend>
  <p class="subtitle">Préciser le sous-type basé sur la présence ou l'absence de constipation</p>
  <p style="font-size: 0.9em; color: #666; font-style: italic; margin: 10px 0;"><strong>Avec constipation et incontinence par débordement :</strong> Selles caractéristiquement mal formées, fuite peut être peu fréquente à continue (jour et nuit). Seule une partie des selles est évacuée lors de la toilette. L'incontinence se résout après traitement de la constipation.</p>
  <p style="font-size: 0.9em; color: #666; font-style: italic; margin: 10px 0;"><strong>Sans constipation et incontinence par débordement :</strong> Selles de forme et consistance normales, souillure intermittente. Les selles peuvent être déposées dans un endroit visible. Souvent associé au TOP ou trouble des conduites, ou conséquence de masturbation anale. Moins fréquent que le sous-type avec constipation.</p>
  <label><input type="radio" name="soustype" value="F98.1 - Avec constipation et incontinence par débordement"/> <strong>F98.1</strong> - Avec constipation et incontinence par débordement : Preuve de constipation à l'examen physique ou par anamnèse</label>
  <label><input type="radio" name="soustype" value="F98.1 - Sans constipation et incontinence par débordement"/> <strong>F98.1</strong> - Sans constipation et incontinence par débordement : Aucune preuve de constipation à l'examen physique ou par anamnèse</label>
  
</fieldset>



<h2 class="section-title" id="titre-diagnostic" style="display: none;">Diagnostic différentiel</h2>

<form id="formulaire-diff" style="display: none;">

<!-- Diagnostic différentiel -->
<fieldset id="diagnostic-differentiel">
  <legend>Diagnostic différentiel</legend>
  <p class="subtitle">Cocher les troubles à différencier</p>
  
  <label><input type="checkbox" name="diff_Autre_affection_m_dicale___Diagnostic_d_encopr_sie_0" value="Autre affection médicale - Diagnostic d'encoprésie en présence d'une autre affection médicale approprié seulement si mécanisme implique constipation non expliquée par autres affections médicales"/> Autre affection médicale - Diagnostic d'encoprésie en présence d'une autre affection médicale approprié seulement si mécanisme implique constipation non expliquée par autres affections médicales</label>
  
  <label><input type="checkbox" name="diff_Incontinence_f_cale_li_e___d_autres_affections_m_d_1" value="Incontinence fécale liée à d'autres affections médicales - Diarrhée chronique, spina bifida, sténose anale ne justifient pas diagnostic DSM-5 d'encoprésie"/> Incontinence fécale liée à d'autres affections médicales - Diarrhée chronique, spina bifida, sténose anale ne justifient pas diagnostic DSM-5 d'encoprésie</label>
  
</fieldset>

</form>

<h2 class="section-title" id="titre-comorbidite" style="display: none;">Comorbidité</h2>

<form id="formulaire-comorb" style="display: none;">

<!-- Comorbidité -->
<fieldset id="comorbidite">
  <legend>Comorbidité</legend>
  <p class="subtitle">Troubles associés</p>
  
  <label><input type="checkbox" name="comorb__nur_sie___Souvent_pr_sente_chez_enfants_avec_enco_0" value="Énurésie - Souvent présente chez enfants avec encoprésie, particulièrement chez enfants avec encoprésie sans constipation et incontinence par débordement"/> Énurésie - Souvent présente chez enfants avec encoprésie, particulièrement chez enfants avec encoprésie sans constipation et incontinence par débordement</label>
  
</fieldset>

</form>

<div class="boutons-validation">
  <button type="button" class="btn-valide" onclick="validerFormulaireLocal(event)">✔️ VALIDER</button>
  <button type="button" class="btn-non-valide" onclick="nonValiderFormulaireLocal(event)">✘ NON VALIDER</button>
</div>

<script>
// Fonctions locales pour gérer l'affichage progressif (indépendantes des fonctions globales Django)
(function() {
  'use strict';
  let etapeNonValide = 0; // 0: début, 1: diagnostic affiché, 2: comorbidité affichée

  // Fonction locale pour valider (ne pas redéfinir la fonction globale)
  window.validerFormulaireLocal = function(event) {
    // Empêcher le comportement par défaut et la propagation
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    // Réinitialiser l'état local
    etapeNonValide = 0;
    
    // Cacher toutes les sections
    const titreDiag = document.getElementById("titre-diagnostic");
    const formDiag = document.getElementById("formulaire-diff");
    const titreComorb = document.getElementById("titre-comorbidite");
    const formComorb = document.getElementById("formulaire-comorb");
    
    if (titreDiag) titreDiag.style.display = "none";
    if (formDiag) formDiag.style.display = "none";
    if (titreComorb) titreComorb.style.display = "none";
    if (formComorb) formComorb.style.display = "none";
    
    // Appeler la fonction globale Django si elle existe
    if (typeof window.validerFormulaire === 'function') {
      window.validerFormulaire();
    }
    
    return false;
  };

  // Fonction locale pour non valider (ne pas redéfinir la fonction globale)
  window.nonValiderFormulaireLocal = function(event) {
    // Empêcher le comportement par défaut et la propagation IMMÉDIATEMENT
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    const titreDiag = document.getElementById("titre-diagnostic");
    const formDiag = document.getElementById("formulaire-diff");
    const titreComorb = document.getElementById("titre-comorbidite");
    const formComorb = document.getElementById("formulaire-comorb");
    
    if (etapeNonValide === 0) {
      // Premier clic : Afficher seulement Diagnostic différentiel (PAS d'enregistrement, PAS d'alerte)
      if (titreDiag) {
        titreDiag.style.display = "block";
        titreDiag.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (formDiag) formDiag.style.display = "block";
      etapeNonValide = 1;
      return false;
      
    } else if (etapeNonValide === 1) {
      // Deuxième clic : Afficher aussi Comorbidité (PAS d'enregistrement, PAS d'alerte)
      if (titreComorb) {
        titreComorb.style.display = "block";
        titreComorb.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (formComorb) formComorb.style.display = "block";
      etapeNonValide = 2;
      return false;
      
    } else if (etapeNonValide === 2) {
      // Troisième clic : Réinitialiser et appeler la fonction globale Django
      etapeNonValide = 0;
      
      // Réinitialiser l'affichage
      if (titreDiag) titreDiag.style.display = "none";
      if (formDiag) formDiag.style.display = "none";
      if (titreComorb) titreComorb.style.display = "none";
      if (formComorb) formComorb.style.display = "none";
      
      // Appeler la fonction globale Django pour enregistrer
      if (typeof window.nonValiderFormulaire === 'function') {
        window.nonValiderFormulaire();
      }
      
      return false;
    }
    
    return false;
  };
})();
</script>

<script>
(function() {
  if (typeof globalThis.validerFormulaire !== 'function') {
    globalThis.validerFormulaire = function() {
      Swal.fire({icon: 'success', title: 'Validé !', text: 'Formulaire marqué comme VALIDE', timer: 2000, showConfirmButton: false});
    };
  }
  if (typeof globalThis.nonValiderFormulaire !== 'function') {
    globalThis.nonValiderFormulaire = function() {
      Swal.fire({icon: 'warning', title: 'Non validé', text: 'Formulaire marqué comme NON VALIDE', timer: 2000, showConfirmButton: false});
    };
  }
})();
</script>
</form>

<div id="resultat"></div>



<footer style="text-align:center; font-size:0.9em; margin-top: 40px; padding-top: 15px; border-top: 1px solid #ccc;">
  <p>CLINIQUE LA VALLÉE – RIAD AL ANDALOUSSE VILLA 39, AV. ABDERRAHIM BOUABID, HAY RIAD 1, Rabat</p>
  <p>Date : 15/10/2025 — <strong style="color:darkred;">DOCUMENT CONFIDENTIEL</strong></p>
</footer>
</body>
</html>
