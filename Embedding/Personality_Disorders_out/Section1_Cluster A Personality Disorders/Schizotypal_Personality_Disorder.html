<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Évaluation Trouble de la Personnalité Schizotypique – DSM-5-TR</title>
  <style>
  .top-bar {
    display: flex;
    align-items: center;
    background-color: #dff0dc;
    padding: 10px 20px;
    margin-bottom: 30px;
    border-radius: 6px;
  }
  .titre-centre {
    flex: 1;
    text-align: center;
  }
  .titre-centre h1 {
    margin: 0;
    font-size: 28px;
    color: #3d7a3b;
  }
  .titre-centre h2 {
    margin: 0;
    font-size: 20px;
    color: #3d7a3b;
  }
  .section-title {
    font-size: 24px;
    font-weight: bold;
    color: #3d7a3b;
    margin: 30px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 3px solid #8cc63f;
  }
    body { font-family: 'Segoe UI', sans-serif; max-width: 960px; margin: auto; padding: 20px; background: #f5fff8; color: #2e3b2c; }
    fieldset { border: 2px solid #8cc63f; padding: 15px; margin-bottom: 20px; background: #ffffff; }
    legend { font-weight: bold; color: #3d7a3b; }
    label { display: block; margin-bottom: 5px; }
    button {
      background-color: #8cc63f;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      margin-top: 10px;
      cursor: pointer;
    }
    button:hover { background-color: #76b42f; }
    .hidden { display: none; }
    .boutons-validation {
      display: flex;
      gap: 15px;
      margin: 40px 0 20px 0;
      justify-content: center;
    }
    .btn-valide,
    .btn-non-valide {
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      flex: 1;
      max-width: 300px;
    }
    .btn-valide {
      background-color: #28a745;
    }
    .btn-valide:hover {
      background-color: #218838;
    }
    .btn-non-valide {
      background-color: #dc3545;
    }
    .btn-non-valide:hover {
      background-color: #c82333;
    }
    .subtitle {
      font-size: 0.9em;
      color: #666;
      font-style: italic;
    }
  </style>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="top-bar">
  <div class="titre-centre">
    <h1>CLINIQUE LA VALLÉE</h1>
    <h2>Évaluation du Trouble de la Personnalité Schizotypique – DSM-5-TR</h2>
  </div>
</div>

<h2 class="section-title">Les critères diagnostiques</h2>

<form id="formulaire">

<!-- Critère A -->
<fieldset id="critereA">
  <legend>Critère A – Pattern envahissant de déficits sociaux et interpersonnels</legend>
  <p class="subtitle">Pattern envahissant de déficits sociaux et interpersonnels marqués par malaise aigu avec et capacité réduite pour relations proches, ainsi que distorsions cognitives ou perceptuelles et excentricités comportementales, débutant au début de l'âge adulte et présent dans divers contextes (au moins 5 des 9 critères suivants sont requis)</p>
  
  <label><input type="checkbox" name="critereA" value="1. Idées de référence (excluant délires de référence)"/> <strong>1.</strong> Idées de référence (excluant délires de référence)</label>
  
  <label><input type="checkbox" name="critereA" value="2. Croyances bizarres ou pensée magique influençant comportement et incompatible avec normes subculturelles"/> <strong>2.</strong> Croyances bizarres ou pensée magique influençant le comportement et incompatible avec normes subculturelles (ex: superstition, croyance en clairvoyance, télépathie, sixième sens; chez enfants/adolescents, fantasmes ou préoccupations bizarres)</label>
  
  <label><input type="checkbox" name="critereA" value="3. Expériences perceptuelles inhabituelles, y compris illusions corporelles"/> <strong>3.</strong> Expériences perceptuelles inhabituelles, y compris illusions corporelles</label>
  
  <label><input type="checkbox" name="critereA" value="4. Pensée et discours bizarres (vague, circonstanciel, métaphorique, surabondant ou stéréotypé)"/> <strong>4.</strong> Pensée et discours bizarres (ex: vague, circonstanciel, métaphorique, surabondant ou stéréotypé)</label>
  
  <label><input type="checkbox" name="critereA" value="5. Méfiance ou idéation paranoïde"/> <strong>5.</strong> Méfiance ou idéation paranoïde</label>
  
  <label><input type="checkbox" name="critereA" value="6. Affect inapproprié ou restreint"/> <strong>6.</strong> Affect inapproprié ou restreint</label>
  
  <label><input type="checkbox" name="critereA" value="7. Comportement ou apparence bizarre, excentrique ou particulier"/> <strong>7.</strong> Comportement ou apparence bizarre, excentrique ou particulier</label>
  
  <label><input type="checkbox" name="critereA" value="8. Manque d'amis proches ou confidents autres que parents au premier degré"/> <strong>8.</strong> Manque d'amis proches ou de confidents autres que les parents au premier degré</label>
  
  <label><input type="checkbox" name="critereA" value="9. Anxiété sociale excessive ne diminuant pas avec familiarité et associée à craintes paranoïdes plutôt que jugements négatifs sur soi"/> <strong>9.</strong> Anxiété sociale excessive qui ne diminue pas avec la familiarité et tend à être associée à des craintes paranoïdes plutôt qu'à des jugements négatifs sur soi</label>
</fieldset>

<!-- Critère B -->
<fieldset id="critereB">
  <legend>Critère B – Exclusion d'autres troubles</legend>
  <p class="subtitle">Ne survient pas exclusivement durant le cours d'autres troubles. Note: Si critères remplis avant début de schizophrénie, ajouter "prémorbide"</p>
  
  <label><input type="checkbox" name="critereB" value="Ne survient pas exclusivement durant cours de schizophrénie"/> Ne survient pas exclusivement durant le cours de la schizophrénie</label>
  <label><input type="checkbox" name="critereB" value="Ne survient pas exclusivement durant trouble bipolaire avec caractéristiques psychotiques"/> Ne survient pas exclusivement durant un trouble bipolaire avec caractéristiques psychotiques</label>
  <label><input type="checkbox" name="critereB" value="Ne survient pas exclusivement durant trouble dépressif avec caractéristiques psychotiques"/> Ne survient pas exclusivement durant un trouble dépressif avec caractéristiques psychotiques</label>
  <label><input type="checkbox" name="critereB" value="Ne survient pas exclusivement durant autre trouble psychotique"/> Ne survient pas exclusivement durant un autre trouble psychotique</label>
  <label><input type="checkbox" name="critereB" value="Ne survient pas exclusivement durant trouble du spectre de l'autisme"/> Ne survient pas exclusivement durant un trouble du spectre de l'autisme</label>
</fieldset>

<!-- Spécificateur -->
<fieldset id="specificateur">
  <legend>Spécificateur</legend>
  
  <p style="margin-top: 10px;"><strong>Relation avec schizophrénie :</strong></p>
  <label><input type="checkbox" name="premorbide" value="Prémorbide"/> Prémorbide (critères remplis avant début de schizophrénie)</label>
</fieldset>

</form>

<h2 class="section-title" id="titre-diagnostic" style="display: none;">Diagnostic différentiel</h2>

<form id="formulaire-diff" style="display: none;">

<fieldset>
  <legend>Diagnostic différentiel</legend>
  <label><input type="checkbox" name="diff_diag" value="Trouble du spectre de l'autisme"/> Trouble du spectre de l'autisme</label>
  <label><input type="checkbox" name="diff_diag" value="Schizophrénie"/> Schizophrénie</label>
  <label><input type="checkbox" name="diff_diag" value="Trouble de l'humeur avec caractéristiques psychotiques"/> Trouble de l'humeur avec caractéristiques psychotiques</label>
  <label><input type="checkbox" name="diff_diag" value="Trouble délirant"/> Trouble délirant</label>
  <label><input type="checkbox" name="diff_diag" value="Changement de personnalité dû à une autre condition médicale"/> Changement de personnalité dû à une autre condition médicale</label>
  <label><input type="checkbox" name="diff_diag" value="Trouble lié à l'usage de substances"/> Trouble lié à l'usage de substances</label>
  <label><input type="checkbox" name="diff_diag" value="Autres troubles de la personnalité"/> Autres troubles de la personnalité (paranoïaque, schizoïde, évitante, borderline, narcissique)</label>
</fieldset>

</form>

<h2 class="section-title" id="titre-comorbidite" style="display: none;">Comorbidité</h2>

<form id="formulaire-comorb" style="display: none;">

<fieldset>
  <legend>Comorbidité</legend>
  <label><input type="checkbox" name="comorbidite" value="Trouble dépressif majeur"/> Trouble dépressif majeur</label>
  <label><input type="checkbox" name="comorbidite" value="Trouble dysthymique"/> Trouble dysthymique</label>
  <label><input type="checkbox" name="comorbidite" value="Autres troubles de la personnalité"/> Autres troubles de la personnalité (paranoïaque, schizoïde, évitante, borderline, narcissique)</label>
</fieldset>

</form>

<div class="boutons-validation">
  <button type="button" class="btn-valide" onclick="validerFormulaireLocal(event)">✔️ VALIDER</button>
  <button type="button" class="btn-non-valide" onclick="nonValiderFormulaireLocal(event)">✘ NON VALIDER</button>
</div>

<footer style="text-align:center; font-size:0.9em; margin-top: 40px; padding-top: 15px; border-top: 1px solid #ccc;">
  <p>CLINIQUE LA VALLÉE – RIAD AL ANDALOUSSE VILLA 39, AV. ABDERRAHIM BOUABID, HAY RIAD 1, Rabat</p>
  <p>Date : 15/10/2025 — <strong style="color:darkred;">DOCUMENT CONFIDENTIEL</strong></p>
</footer>

<script>
// Gestion locale des boutons pour révéler progressivement Diagnostic différentiel et Comorbidité
(function() {
  'use strict';
  let etapeNonValide = 0; // 0: début, 1: diagnostic affiché, 2: comorbidité affichée

  // Fonction locale pour valider (ne pas redéfinir la fonction globale)
  window.validerFormulaireLocal = function(event) {
    // Empêcher le comportement par défaut et la propagation
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    // Réinitialiser l'état local
    etapeNonValide = 0;
    
    // Cacher toutes les sections
    const titreDiag = document.getElementById("titre-diagnostic");
    const formDiag = document.getElementById("formulaire-diff");
    const titreComorb = document.getElementById("titre-comorbidite");
    const formComorb = document.getElementById("formulaire-comorb");
    
    if (titreDiag) titreDiag.style.display = "none";
    if (formDiag) formDiag.style.display = "none";
    if (titreComorb) titreComorb.style.display = "none";
    if (formComorb) formComorb.style.display = "none";
    
    // Appeler la fonction globale Django si elle existe
    if (typeof window.validerFormulaire === 'function') {
      window.validerFormulaire();
    }
    
    return false;
  };

  // Fonction locale pour non valider (ne pas redéfinir la fonction globale)
  window.nonValiderFormulaireLocal = function(event) {
    // Empêcher le comportement par défaut et la propagation IMMÉDIATEMENT
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    const titreDiag = document.getElementById("titre-diagnostic");
    const formDiag = document.getElementById("formulaire-diff");
    const titreComorb = document.getElementById("titre-comorbidite");
    const formComorb = document.getElementById("formulaire-comorb");
    
    if (etapeNonValide === 0) {
      // Premier clic : Afficher seulement Diagnostic différentiel (PAS d'enregistrement, PAS d'alerte)
      if (titreDiag) {
        titreDiag.style.display = "block";
        titreDiag.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (formDiag) formDiag.style.display = "block";
      etapeNonValide = 1;
      return false;
      
    } else if (etapeNonValide === 1) {
      // Deuxième clic : Afficher aussi Comorbidité (PAS d'enregistrement, PAS d'alerte)
      if (titreComorb) {
        titreComorb.style.display = "block";
        titreComorb.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (formComorb) formComorb.style.display = "block";
      etapeNonValide = 2;
      return false;
      
    } else if (etapeNonValide === 2) {
      // Troisième clic : Réinitialiser et appeler la fonction globale Django
      etapeNonValide = 0;
      
      // Réinitialiser l'affichage
      if (titreDiag) titreDiag.style.display = "none";
      if (formDiag) formDiag.style.display = "none";
      if (titreComorb) titreComorb.style.display = "none";
      if (formComorb) formComorb.style.display = "none";
      
      // Appeler la fonction globale Django pour enregistrer
      if (typeof window.nonValiderFormulaire === 'function') {
        window.nonValiderFormulaire();
      }
      
      return false;
    }
    
    return false;
  };
})();
</script>

<script>
// Fonctions de fallback pour compatibilité standalone
function validerFormulaire() {
  Swal.fire({icon: 'success', title: 'Validé !', text: 'Formulaire marqué comme VALIDE', timer: 2000, showConfirmButton: false});
}

function nonValiderFormulaire() {
  Swal.fire({icon: 'warning', title: 'Non validé', text: 'Formulaire marqué comme NON VALIDE', timer: 2000, showConfirmButton: false});
}
</script>

</body>
</html>

